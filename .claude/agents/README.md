# CRM Agents - Quick Start

This directory contains specialized agents for CRM workflow automation and system improvement.

## Available Agents

### 1. opportunity-advancer (Business Operations)
Mirrors your Notion AI Process 2.2: analyzes meeting notes and recommends 6 field updates to keep your pipeline moving.

**Invocation:** `"Analyze opportunity [Name]"`

### 2. system-implementer (Technical Enablement)
Executes validated system modifications while preventing degradation and maintaining all project principles.

**Invocation:** `"Implement issue #[number]"` or `"Implement [description]"`

### 3. cs-agent-validator (Technical Enablement)
Validates user feedback against project specifications and creates GitHub issues for improvements.

### 4. ai-enablement-reviewer (Technical Enablement)
Reviews agent configs, prompts, skills for token efficiency and business value.

### 5. business-architect (Technical Enablement)
Designs business processes using agentic AI systems with SPAR framework.

---

## Opportunity Advancer Agent

### What It Does

Analyzes meeting notes and recommends 6 field updates to keep your pipeline moving.

## How to Use

### Basic Invocation

```
"Analyze opportunity [Name]"
```

or

```
"Update progress for [Opportunity Name]"
```

### What Happens

1. Agent searches Oportunidades database
2. Loads 2-3 most recent interactions (meeting notes)
3. Analyzes transcript/summary/notes across interactions
4. Generates 6 proposed fields:
   - Update Log (1 sentence, ‚â§10 words)
   - Next Action (specific, actionable)
   - Next Action Date (calculated from last meeting + 7 days)
   - Biz Funnel (detects stage advancement)
   - Status (In Progress / Waiting Feedback / Scheduled)
   - AI Advancement Recommendation (strategic insights)
5. Shows you proposed updates
6. Waits for your approval
7. Updates Notion (only after you confirm)

### Example Session

```
You: "Analyze opportunity Projeto SiDi"

Agent: [Searches database]
Agent: [Loads meeting notes from 18/11]
Agent: [Analyzes transcript]

# Opportunity Update: Projeto SiDi

**Last Interaction:** 2025-11-18
**Current Stage:** Credibilidade ‚Üí Oferta

## Proposed Updates
1. Update Log: 18/11: cliente solicitou proposta de pricing
2. Next Action: Enviar proposta comercial
3. Next Action Date: 2025-11-25
4. Biz Funnel: Oferta (Changed: yes - client asked for pricing)
5. Status: In Progress
6. AI Advancement Recommendation: Cliente mencionou or√ßamento em 2 intera√ß√µes recentes - forte interesse. Incluir case study similar para acelerar decis√£o.

**Apply these updates?** [Y/N]

You: Y

Agent: [Updates Notion]
Agent: ‚úÖ Opportunity updated successfully!
```

## When to Use

- After client meetings (when you have new Anota√ß√µes)
- When you want to compare Claude Code vs Notion AI output
- To update opportunities with Offline Notes (no formal meeting)

## Requirements

- Opportunity must exist in Oportunidades database
- Must have either:
  - At least 1 Anota√ß√£o with content, OR
  - Offline Notes field populated

## Tips

**Use exact opportunity names:**
- ‚úÖ "Projeto SiDi - Nova Plataforma"
- ‚ùå "projeto sidi" (may not find exact match)

**If multiple results:**
- Agent will show list and ask you to choose

**If no meeting data:**
- Agent will error: "No meeting data to process"
- Add Offline Notes or create Anota√ß√£o first

## Compare with Notion AI

To validate the hybrid approach:

1. Pick 3-5 real opportunities
2. Run Claude Code agent: `"Analyze opportunity [Name]"`
3. Run Notion AI: `"Atualize o avan√ßo da oportunidade [Nome]"`
4. Compare the 6 fields generated by each
5. Note differences and patterns

**Target:** >80% match between outputs

## Troubleshooting

**"Opportunity not found"**
- Check spelling (case-sensitive)
- Try full opportunity name
- Use Notion URL instead: `"Analyze opportunity https://notion.so/..."`

**"No meeting data to process"**
- Add content to Anota√ß√µes or Offline Notes
- Verify Anota√ß√£o has <transcript>, <summary>, or <notes> tags

**Agent suggests wrong Biz Funnel stage**
- You can reject the update
- Agent learns from corrections (future feature)
- For now: adjust manually

**Update failed**
- Check `.env` has valid NOTION_API_KEY
- Ensure MCP server is running (auto-loads with Claude Code)
- Verify user approved the write operation

## Configuration

**Agent file:** `.claude/agents/opportunity-advancer.md`

**Edit to adjust:**
- System instructions (SENSE/PLAN/ACT/REFLECT logic)
- Constraints (e.g., Update Log max length)
- Output format

**Skill file:** `.claude/skills/crm-data-model/SKILL.md`

**Edit to adjust:**
- Biz Funnel stages
- Advancement signals
- Status decision rules

## Next Steps

After validating this agent works (Phase 0 complete):
- **Phase 1:** Weekly Pipeline Digest agent
- **Phase 2:** Meeting Prep Briefer
- **Phase 3:** Follow-up Drafter
- **Phase 4:** Orchestration (agents working together)

---

## System Implementer Agent

### What It Does

Executes validated system modifications (from GitHub issues, cs-agent-validator, ai-enablement-reviewer, or business-architect) with disciplined engineering practices that prevent system degradation.

### How to Use

#### Basic Invocation

```
"Implement issue #2"
```

or

```
"Implement: Add validation for empty Biz Funnel"
```

### What Happens

1. **SENSE:** Loads the request and understands current system state
   - Reads GitHub issue or clarifies description
   - Scans PRINCIPLES.md, CLAUDE.md, agentic-workflow-map.md
   - Maps dependencies and affected files
   - Assesses risk level (low/medium/high)

2. **PLAN:** Designs minimal solution and presents for approval
   - Lists all files requiring changes
   - Sequences changes (bottom-up: skills ‚Üí agents ‚Üí docs)
   - Estimates effort per file
   - Shows proposed changes with risk assessment
   - Waits for explicit approval

3. **ACT:** Implements changes sequentially
   - Reads current state of each file
   - Shows proposed change before applying
   - Requests approval for critical files
   - Executes change and verifies success
   - Updates checklist as progresses

4. **REFLECT:** Validates implementation quality
   - Checks completeness (all planned changes done?)
   - Verifies consistency (no orphaned references?)
   - Validates principle compliance (PRINCIPLES.md respected?)
   - Checks for regressions (existing functionality intact?)
   - Suggests validation steps for user testing
   - Provides ready-to-use git commit message

### Example Session

```
You: "Implement issue #2"

Agent: [Reads GitHub issue #2: Consolidate Update Log into Notas]

## Implementation Plan: Consolidate Update Log into Notas

### Current State
- Update Log field exists separately from Notas
- opportunity-advancer updates 6 fields including Update Log
- Redundancy between Update Log and Notas/Hist√≥rico

### Proposed Changes

#### 1. .claude/skills/crm-data-model/SKILL.md
**Change:** Remove Update Log from field definitions, document new Notas format
**Reason:** Eliminate redundancy, consolidate into Notas with #ai tags
**Risk:** Low (documentation only)

#### 2. .claude/agents/opportunity-advancer.md
**Change:** Remove Update Log from 6-field list, add Notas prepend logic
**Reason:** Implement new consolidated approach
**Risk:** Medium (affects core agent logic)

[... more files ...]

Total: 1-1.5 hours

**Proceed with implementation?** [Y/N]

You: Y

Agent: [Implements changes sequentially, showing each modification]
Agent: [Updates docs to match code changes]
Agent: [Validates no broken references]

## Implementation Complete

### Changes Applied
- crm-data-model skill: Updated field definitions
- opportunity-advancer agent: Now writes to Notas with #ai tags
- Documentation: Updated CLAUDE.md, phase-0 docs

### Validation Status
‚úÖ All files modified successfully
‚úÖ No orphaned references found
‚úÖ PRINCIPLES.md compliance maintained
üöß Pending: Test opportunity-advancer with sample opportunity

### Recommended Next Steps
1. Test: "Analyze opportunity [Name]" to verify Notas format
2. Verify: Updates appear as "### YYYY-MM-DD HH:MM #ai"
3. Validate: No Update Log references remain in output

**Ready to commit and push.**
```

### When to Use

- After cs-agent-validator creates a GitHub issue
- When ai-enablement-reviewer provides optimization recommendations
- When business-architect designs a new process to implement
- For any system modification that affects multiple files
- When you need disciplined, principle-respecting implementation

### Safety Features

**The agent will:**
- ‚úÖ Always read files before modifying
- ‚úÖ Show proposed changes before executing
- ‚úÖ Request approval for critical modifications
- ‚úÖ Validate no functionality regression
- ‚úÖ Update documentation to match code
- ‚úÖ Check cross-references for consistency
- ‚úÖ Respect all 20 PRINCIPLES.md guidelines
- ‚úÖ Maintain human validation gates
- ‚úÖ Provide validation checklist for testing

**The agent will NOT:**
- ‚ùå Modify code without reading it first
- ‚ùå Skip documentation updates
- ‚ùå Add features beyond requested scope
- ‚ùå Remove functionality without approval
- ‚ùå Break existing agents to fix one issue
- ‚ùå Implement without presenting plan first

### Risk Assessment

**Low Risk Changes:**
- Documentation-only updates
- Single file modifications
- No breaking changes to APIs or data model

**Medium Risk Changes:**
- Multi-file updates
- Agent logic modifications
- Affects 1-2 agents

**High Risk Changes:**
- Data model modifications
- Affects multiple agents
- Alters user workflow
- Changes MCP integrations

High risk changes receive extra scrutiny and detailed approval gates.

### Integration with Workflow

This agent is part of the **Technical Enablement Flow** in the agentic workflow:

```
User Feedback ‚Üí cs-agent-validator ‚Üí GitHub Issue ‚Üí
  system-implementer ‚Üí Implementation ‚Üí Validation
```

It can also receive input from:
- ai-enablement-reviewer (optimization recommendations)
- business-architect (process designs)
- Direct user requests (ad-hoc improvements)

### Configuration

**Agent file:** `.claude/agents/system-implementer.md`

**Principle compliance:**
- Principle 2: Skills vs Agents Separation
- Principle 4: Error Handling is Non-Negotiable
- Principle 5: Be Explicit, Never Vague
- Principle 14: User Control First
- Principle 16: Iterative Refinement Over Perfection

### Troubleshooting

**"Cannot find issue #N"**
- Verify issue number exists in GitHub
- Or provide description instead: "Implement: [description]"

**"Plan too complex"**
- Agent will break into smaller phases
- Approve phase-by-phase implementation

**"Change affects too many files"**
- Agent will flag high risk
- Review impact assessment before approving

---

For detailed implementation: See `docs/phase-0-lean-implementation.md`

For future architecture: See `docs/spar-architecture-future-reference.md`
